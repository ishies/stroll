<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stroll App - Sign Up</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Clarendon', 'Georgia', serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .phone-container { width: 320px; height: 600px; background: linear-gradient(180deg, #a8d5ba 0%, #6fb583 50%, #4a9b63 100%); border-radius: 30px; padding: 40px 25px; position: relative; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .back-arrow { position: absolute; top: 30px; left: 25px; width: 35px; height: 35px; background: rgba(255,255,255,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; cursor: pointer; z-index: 10; }
        .sky-buildings { position: absolute; top: 0; left: 0; width: 100%; height: 220px; background: linear-gradient(180deg, #d4f0e1 0%, #b5ddc4 100%); z-index: 1; }
        .building-skyline { position: absolute; bottom: 0; left: 0; width: 100%; height: 180px; display: flex; align-items: flex-end; justify-content: space-between; padding: 0 10px; opacity: 0.4; }
        .skyscraper { background: linear-gradient(180deg, #5a9b6d 0%, #4a8b5d 100%); border-radius: 2px 2px 0 0; position: relative; }
        .sky-1 { width: 25px; height: 140px; } .sky-2 { width: 30px; height: 160px; } .sky-3 { width: 22px; height: 120px; } .sky-4 { width: 35px; height: 180px; } .sky-5 { width: 28px; height: 150px; } .sky-6 { width: 32px; height: 145px; } .sky-7 { width: 26px; height: 130px; } .sky-8 { width: 30px; height: 155px; }
        .sun { position: absolute; top: 60px; right: 50px; width: 60px; height: 60px; background: radial-gradient(circle, #ffe5a0 0%, #ffd700 100%); border-radius: 50%; box-shadow: 0 0 40px rgba(255,215,0,0.4); z-index: 2; }
        .park-ground { position: absolute; bottom: 0; left: 0; width: 100%; height: 380px; background: linear-gradient(180deg, #6fb583 0%, #4a9b63 100%); z-index: 3; }
        .tree-container { position: absolute; z-index: 7; }
        .tree { font-size: 45px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
        .tree-1 { top: 160px; left: 15px; } .tree-2 { top: 150px; right: 20px; } .tree-3 { top: 200px; left: 60px; } .tree-4 { top: 190px; right: 70px; }
        .path-svg { position: absolute; top: 180px; left: 0; width: 100%; height: 250px; z-index: 5; }
        .person { position: absolute; font-size: 24px; z-index: 6; animation: walk 2s ease-in-out infinite; }
        @keyframes walk { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-3px); } }
        .person-1 { top: 220px; left: 50px; animation-delay: 0s; } .person-2 { top: 235px; left: 130px; animation-delay: 0.5s; } .person-3 { top: 230px; right: 80px; animation-delay: 1s; }
        .bike { position: absolute; font-size: 28px; z-index: 6; }
        .bike-1 { top: 255px; left: 90px; }
        .cloud { position: absolute; color: rgba(255, 255, 255, 0.5); font-size: 30px; z-index: 2; }
        .cloud-1 { top: 80px; left: 40px; } .cloud-2 { top: 100px; right: 60px; }
        .content { position: relative; z-index: 10; text-align: center; margin-top: 260px; }
        h1 { color: white; font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .subtitle { color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 20px; }
        .form-group { margin-bottom: 14px; text-align: left; }
        .form-label { display: block; color: white; font-size: 14px; margin-bottom: 8px; font-weight: 600; }
        .form-input { width: 100%; padding: 12px 14px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; font-size: 15px; background: rgba(255,255,255,0.9); color: #333; font-family: 'Clarendon', 'Georgia', serif; }
        .button { width: 100%; padding: 16px; border: none; border-radius: 15px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .signup-btn { background: linear-gradient(135deg, #8b5a3c 0%, #a0745c 100%); color: white; box-shadow: 0 4px 15px rgba(139,90,60,0.4); }
        .signup-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .link-row { margin-top: 12px; color: white; font-size: 14px; }
        .link-row a { color: white; font-weight: 700; text-decoration: none; }
        #signup-error { display:none; color:#ffe5e5; background:rgba(0,0,0,0.15); padding:8px; border-radius:8px; margin-bottom:12px; font-size:13px; }
        .city-buildings { position: absolute; bottom: 0; left: 0; width: 100%; height: 200px; z-index: 8; display: flex; justify-content: space-between; align-items: flex-end; }
        .building { background: linear-gradient(180deg, #4a5568 0%, #2d3748 100%); position: relative; }
        .building-left-1 { width: 45px; height: 170px; margin-left: 0; } .building-left-2 { width: 50px; height: 200px; margin-left: -20px; } .building-left-3 { width: 38px; height: 140px; margin-left: -18px; }
        .building-right-1 { width: 40px; height: 150px; margin-right: -18px; } .building-right-2 { width: 52px; height: 200px; margin-right: -20px; } .building-right-3 { width: 46px; height: 175px; margin-right: 0; }
        .window { position: absolute; width: 4px; height: 5px; background: rgba(255, 215, 0, 0.5); }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="back-arrow" onclick="window.location.href='index.html'">‚Äπ</div>
        
        <!-- Sky and background buildings -->
        <div class="sky-buildings">
            <div class="building-skyline">
                <div class="skyscraper sky-1"></div>
                <div class="skyscraper sky-2"></div>
                <div class="skyscraper sky-3"></div>
                <div class="skyscraper sky-4"></div>
                <div class="skyscraper sky-5"></div>
                <div class="skyscraper sky-6"></div>
                <div class="skyscraper sky-7"></div>
                <div class="skyscraper sky-8"></div>
            </div>
        </div>

        <div class="sun"></div>

        <div class="cloud cloud-1">‚òÅÔ∏è</div>
        <div class="cloud cloud-2">‚òÅÔ∏è</div>

        <!-- Park ground -->
        <div class="park-ground"></div>

        <!-- Trees -->
        <div class="tree-container tree-1">
            <div class="tree">üå≥</div>
        </div>
        <div class="tree-container tree-2">
            <div class="tree">üå≥</div>
        </div>
        <div class="tree-container tree-3">
            <div class="tree">üå≤</div>
        </div>
        <div class="tree-container tree-4">
            <div class="tree">üå≤</div>
        </div>

        <!-- Walking paths -->
        <svg class="path-svg" viewBox="0 0 270 250" xmlns="http://www.w3.org/2000/svg">
            <path d="M 10 60 C 40 50, 70 45, 100 50 S 150 60, 180 55 S 220 45, 260 50" 
                  stroke="rgba(255,255,255,0.5)" 
                  stroke-width="6" 
                  fill="none" 
                  stroke-linecap="round"/>
            
            <path d="M 5 100 C 50 90, 90 110, 130 105 S 180 95, 220 105 S 250 115, 270 110" 
                  stroke="rgba(255,255,255,0.45)" 
                  stroke-width="6" 
                  fill="none" 
                  stroke-linecap="round"/>
            
            <path d="M 20 140 C 60 135, 100 145, 140 140 S 190 130, 230 135" 
                  stroke="rgba(255,255,255,0.4)" 
                  stroke-width="5" 
                  fill="none" 
                  stroke-linecap="round"/>
        </svg>

        <!-- People and bikes -->
        <div class="person person-1">üö∂‚Äç‚ôÄÔ∏è</div>
        <div class="person person-2">üö∂</div>
        <div class="person person-3">üö∂‚Äç‚ôÇÔ∏è</div>
        <div class="bike bike-1">üö¥</div>

        <!-- Content -->
        <div class="content">
            <h1>Create Account</h1>
            <p class="subtitle">Join Stroll ‚Äî it only takes a minute</p>

            <div id="signup-error"></div>
            <form id="signup-form" novalidate>
                <div class="form-group">
                    <label class="form-label" for="signup-email">Email</label>
                    <input type="email" id="signup-email" class="form-input" placeholder="your@email.com" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="signup-password">Password</label>
                    <input type="password" id="signup-password" class="form-input" placeholder="Create a password" required>
                </div>

                <button type="submit" class="button signup-btn" id="signup-btn">Sign Up</button>
            </form>

            <div class="link-row">Already have an account? <a href="stroll-signin.html">Sign In</a></div>
        </div>

        <!-- Foreground buildings -->
        <div class="city-buildings">
            <div style="display: flex; align-items: flex-end;">
                <div class="building building-left-1">
                    <div class="window" style="top: 30px; left: 12px;"></div>
                    <div class="window" style="top: 30px; left: 22px;"></div>
                    <div class="window" style="top: 50px; left: 12px;"></div>
                    <div class="window" style="top: 50px; left: 22px;"></div>
                    <div class="window" style="top: 70px; left: 12px;"></div>
                    <div class="window" style="top: 70px; left: 22px;"></div>
                </div>
                <div class="building building-left-2">
                    <div class="window" style="top: 30px; left: 14px;"></div>
                    <div class="window" style="top: 30px; left: 26px;"></div>
                    <div class="window" style="top: 55px; left: 14px;"></div>
                    <div class="window" style="top: 55px; left: 26px;"></div>
                    <div class="window" style="top: 80px; left: 14px;"></div>
                    <div class="window" style="top: 80px; left: 26px;"></div>
                </div>
                <div class="building building-left-3">
                    <div class="window" style="top: 30px; left: 10px;"></div>
                    <div class="window" style="top: 30px; left: 20px;"></div>
                    <div class="window" style="top: 50px; left: 10px;"></div>
                    <div class="window" style="top: 50px; left: 20px;"></div>
                </div>
            </div>
            <div style="display: flex; align-items: flex-end;">
                <div class="building building-right-1">
                    <div class="window" style="top: 30px; left: 10px;"></div>
                    <div class="window" style="top: 30px; left: 20px;"></div>
                    <div class="window" style="top: 50px; left: 10px;"></div>
                    <div class="window" style="top: 50px; left: 20px;"></div>
                </div>
                <div class="building building-right-2">
                    <div class="window" style="top: 30px; left: 15px;"></div>
                    <div class="window" style="top: 30px; left: 27px;"></div>
                    <div class="window" style="top: 55px; left: 15px;"></div>
                    <div class="window" style="top: 55px; left: 27px;"></div>
                    <div class="window" style="top: 80px; left: 15px;"></div>
                    <div class="window" style="top: 80px; left: 27px;"></div>
                </div>
                <div class="building building-right-3">
                    <div class="window" style="top: 30px; left: 13px;"></div>
                    <div class="window" style="top: 30px; left: 23px;"></div>
                    <div class="window" style="top: 55px; left: 13px;"></div>
                    <div class="window" style="top: 55px; left: 23px;"></div>
                    <div class="window" style="top: 75px; left: 13px;"></div>
                    <div class="window" style="top: 75px; left: 23px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCZlUYoU77T2cBHTxlQW6FWaMVX_0yZ5rc",
      authDomain: "stroll-c5285.firebaseapp.com",
      projectId: "stroll-c5285",
      storageBucket: "stroll-c5285.firebasestorage.app",
      messagingSenderId: "465458957302",
      appId: "1:465458957302:web:1b104b86069514164615d7",
      measurementId: "G-PZY4GX7SSE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const signupForm = document.getElementById('signup-form');
    const signupError = document.getElementById('signup-error');
    const signupBtn = document.getElementById('signup-btn');

    if (signupForm) {
      signupForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        signupError.style.display = 'none';
        
        const email = document.getElementById('signup-email').value.trim();
        const password = document.getElementById('signup-password').value;

        // Disable button during signup
        signupBtn.disabled = true;
        signupBtn.textContent = 'Creating Account...';

        try {
          // Create Firebase Auth user
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;
          
          console.log('‚úÖ User created in Auth:', user.uid);

          // Create user document in Firestore
          // Note: Cluster will be assigned after survey, so we set it to null initially
          const usersRef = collection(db, 'users');
          await addDoc(usersRef, {
            uid: user.uid,
            email: email,
            Cluster: null,  // Will be assigned after survey
            preferences: {},  // Empty preferences initially
            CreatedAt: serverTimestamp()
          });

          console.log('‚úÖ User document created in Firestore');

          // Redirect to survey page to determine cluster
          window.location.href = 'stroll-survey.html';
          
        } catch (err) {
          console.error('‚ùå Signup error', err);
          let msg = 'Sign-up failed. Please check the details and try again.';
          if (err && err.code) {
            if (err.code === 'auth/email-already-in-use') msg = 'That email is already in use.';
            else if (err.code === 'auth/weak-password') msg = 'Password is too weak (min 6 chars).';
            else if (err.code === 'auth/invalid-email') msg = 'Invalid email address.';
          }
          signupError.textContent = msg;
          signupError.style.display = 'block';
          
          // Re-enable button
          signupBtn.disabled = false;
          signupBtn.textContent = 'Sign Up';
        }
      });
    }
    </script>
</body>
</html>
