<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stroll App - Nearby POI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Clarendon', 'Georgia', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .phone-container {
            width: 320px;
            height: 600px;
            background: linear-gradient(180deg, #a8d5ba 0%, #6fb583 50%, #4a9b63 100%);
            border-radius: 30px;
            padding: 40px 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .back-arrow {
            position: absolute;
            top: 30px;
            left: 25px;
            width: 35px;
            height: 35px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            z-index: 10;
            transition: background 0.2s;
        }

        .back-arrow:hover {
            background: rgba(255,255,255,0.4);
        }

        .top-actions {
            position: absolute;
            top: 30px;
            right: 25px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .action-btn {
            width: 35px;
            height: 35px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.05);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .heart-btn.liked {
            background: rgba(255,255,255,0.9);
            color: #e53e3e;
            animation: heartPulse 0.3s ease-in-out;
        }

        @keyframes heartPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .refresh-btn.spinning {
            animation: spin 0.6s ease-in-out;
        }

        .refresh-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .refresh-icon svg {
            width: 100%;
            height: 100%;
        }

        .content {
            position: relative;
            z-index: 5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 60px;
        }

        .map-container {
            width: 100%;
            height: 220px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-bottom: 15px;
        }

        .map-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        h1 {
            color: white;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .poi-box {
            width: 100%;
            background: white;
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .poi-name {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 6px;
        }

        .poi-distance {
            font-size: 15px;
            color: #718096;
        }

        .button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Clarendon', 'Georgia', serif;
            background: linear-gradient(135deg, #8b5a3c 0%, #a0745c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(139,90,60,0.4);
        }

        .button:hover {
            box-shadow: 0 6px 20px rgba(139,90,60,0.5);
        }

        .button:active {
            transform: scale(0.98);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="back-arrow" onclick="window.history.back()">â€¹</div>
        
        <div class="top-actions">
            <button class="action-btn refresh-btn" id="refreshBtn" title="Refresh POI">
                <div class="refresh-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 12C4 7.58172 7.58172 4 12 4C14.5264 4 16.7792 5.17108 18.2454 7" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <path d="M20 12C20 16.4183 16.4183 20 12 20C9.47362 20 7.22082 18.8289 5.75463 17" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <path d="M17 7L18.5 7L18.5 5.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M7 17L5.5 17L5.5 18.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </button>
            <button class="action-btn heart-btn" id="heartBtn" title="Like this POI">
                â™¡
            </button>
        </div>
        
        <div class="content">
            <div class="map-container">
                <svg class="map-image" viewBox="0 0 270 280" xmlns="http://www.w3.org/2000/svg">
                    <!-- Background -->
                    <rect width="270" height="280" fill="#e8f5e9"/>
                    
                    <!-- Roads -->
                    <line x1="0" y1="140" x2="270" y2="140" stroke="#cbd5e0" stroke-width="8"/>
                    <line x1="135" y1="0" x2="135" y2="280" stroke="#cbd5e0" stroke-width="8"/>
                    
                    <!-- Green spaces (parks) -->
                    <rect x="20" y="20" width="80" height="80" fill="#81c784" rx="8"/>
                    <rect x="170" y="170" width="80" height="80" fill="#81c784" rx="8"/>
                    
                    <!-- Buildings -->
                    <rect x="150" y="30" width="40" height="50" fill="#a0aec0" rx="4"/>
                    <rect x="200" y="40" width="35" height="60" fill="#a0aec0" rx="4"/>
                    <rect x="30" y="160" width="50" height="45" fill="#a0aec0" rx="4"/>
                    <rect x="90" y="175" width="30" height="55" fill="#a0aec0" rx="4"/>
                    
                    <!-- Location pin (user location) -->
                    <circle cx="135" cy="140" r="20" fill="#4a9b63" opacity="0.3"/>
                    <circle cx="135" cy="140" r="10" fill="#4a9b63"/>
                    <circle cx="135" cy="140" r="5" fill="white"/>
                    
                    <!-- POI marker (coffee shop) -->
                    <g transform="translate(180, 90)">
                        <path d="M 0 -20 Q -8 -20, -8 -12 L -8 12 Q -8 20, 0 20 Q 8 20, 8 12 L 8 -12 Q 8 -20, 0 -20 Z" fill="#8b5a3c"/>
                        <circle cx="0" cy="25" r="3" fill="#8b5a3c"/>
                    </g>
                </svg>
            </div>
            
            <h1>Nearby POI</h1>
            
            <div class="poi-box">
                <div class="poi-name">Blue Bottle Coffee</div>
                <div class="poi-distance">450 W 15th St, New York, NY 10011</div>
            </div>
            
            <button class="button" id="detailsBtn">See Details</button>
        </div>
    </div>

    <script>
        // Firebase configuration - REPLACE WITH YOUR NEW CREDENTIALS
        const firebaseConfig = {
            apiKey: "YOUR_NEW_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.firebasestorage.app",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Set to true to use Firebase, false for mock data
        const USE_FIREBASE = false;

        // Mock POI data for demonstration
        const mockPOIs = [
            {
                name: "Blue Bottle Coffee",
                address: "450 W 15th St, New York, NY 10011",
                type: "coffee_shop",
                amenity: "cafe"
            },
            {
                name: "Stumptown Coffee Roasters",
                address: "30 W 8th St, New York, NY 10011",
                type: "coffee_shop",
                amenity: "cafe"
            },
            {
                name: "The High Line",
                address: "New York, NY 10011",
                type: "park",
                amenity: "park"
            },
            {
                name: "Chelsea Market",
                address: "75 9th Ave, New York, NY 10011",
                type: "market",
                amenity: "marketplace"
            },
            {
                name: "Joe's Pizza",
                address: "7 Carmine St, New York, NY 10014",
                type: "restaurant",
                amenity: "restaurant"
            },
            {
                name: "Washington Square Park",
                address: "Washington Square, New York, NY 10012",
                type: "park",
                amenity: "park"
            },
            {
                name: "Strand Bookstore",
                address: "828 Broadway, New York, NY 10003",
                type: "bookstore",
                amenity: "bookstore"
            }
        ];

        let currentPOI = null;
        let likedPOIs = [];
        let isLiked = false;
        let userPreferences = {};
        let db = null;
        let auth = null;
        let shownPOIs = []; // Track shown POIs to avoid repeats
        let userDocId = null; // Store user document ID for updates
        let firebaseApp = null; // Store Firebase app instance

        // Parse amenities from cluster data
        function parseAmenities(raw) {
            if (!raw) return [];
            
            if (typeof raw === 'string') {
                const tupleRegex = /\(\s*([^,]+?)\s*,\s*(\d+)\s*\)/g;
                const matches = [];
                let match;
                while ((match = tupleRegex.exec(raw)) !== null) {
                    matches.push({
                        amenity: match[1].trim(),
                        frequency: Number(match[2]) || 1
                    });
                }
                if (matches.length > 0) return matches;
            }
            
            if (Array.isArray(raw)) {
                return raw.map(item => {
                    if (Array.isArray(item)) {
                        return { amenity: item[0], frequency: Number(item[1]) || 0 };
                    }
                    if (typeof item === 'object') {
                        const amen = item.amenity || item.name || item[0];
                        const freq = item.frequency || item.freq || item.count || 1;
                        return { amenity: amen, frequency: Number(freq) || 0 };
                    }
                    return { amenity: String(item), frequency: 1 };
                });
            }
            
            return [{ amenity: String(raw), frequency: 1 }];
        }

        // Weighted selection
        function weightedPick(items) {
            const total = items.reduce((s, it) => s + (Number(it.frequency) || 0), 0);
            if (total <= 0) {
                return items[Math.floor(Math.random() * items.length)];
            }
            let r = Math.random() * total;
            for (const it of items) {
                r -= (Number(it.frequency) || 0);
                if (r <= 0) return it;
            }
            return items[items.length - 1];
        }

        // Load POI with Firebase
        async function loadPOIWithFirebase() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    console.warn('No authenticated user');
                    loadPOIMock();
                    return;
                }

                // Import Firebase modules dynamically (only if not already done)
                if (!db) {
                    const { getFirestore } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                    db = getFirestore(firebaseApp);
                    console.log('âœ… Firestore initialized');
                }

                const { collection, getDocs, query, where, limit } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');

                // Get user profile
                const usersRef = collection(db, 'users');
                let q = query(usersRef, where('uid', '==', user.uid));
                let snap = await getDocs(q);
                
                if (snap.empty && user.email) {
                    q = query(usersRef, where('email', '==', user.email));
                    snap = await getDocs(q);
                }

                if (snap.empty) {
                    console.warn('No user profile found');
                    loadPOIMock();
                    return;
                }

                // Get most recent profile and store document ID
                let userDoc = snap.docs[0];
                if (snap.size > 1) {
                    userDoc = snap.docs.reduce((best, d) => {
                        const a = best.data().CreatedAt || '';
                        const b = d.data().CreatedAt || '';
                        return (b > a) ? d : best;
                    }, snap.docs[0]);
                }

                userDocId = userDoc.id; // Store for later updates
                const userData = userDoc.data();
                const cluster = userData.Cluster;
                
                // Parse preferences - handle both string and number formats
                const rawPrefs = userData.preferences || {};
                userPreferences = {};
                for (const key in rawPrefs) {
                    userPreferences[key] = parseInt(rawPrefs[key]) || 0;
                }

                console.log('User cluster:', cluster);
                console.log('User preferences:', userPreferences);
                console.log('User document ID:', userDocId);

                // Get cluster centroid
                const centroidsRef = collection(db, 'clusters');
                const centQ = query(centroidsRef, where('Cluster', '==', cluster), limit(1));
                const centSnap = await getDocs(centQ);

                if (centSnap.empty) {
                    console.warn('No centroid found');
                    loadPOIMock();
                    return;
                }

                const centroid = centSnap.docs[0].data();
                const rawAmenities = centroid.amenities || centroid.Amenities;
                const amenities = parseAmenities(rawAmenities);

                if (!amenities || amenities.length === 0) {
                    console.warn('No amenities in centroid');
                    loadPOIMock();
                    return;
                }

                // EXPLORATION: 20% chance to try a random amenity from cluster
                const EXPLORATION_RATE = 0.20;
                let amenityChoice;
                
                if (Math.random() < EXPLORATION_RATE) {
                    // Explore: pick random amenity from cluster (unweighted)
                    const randomAmenity = amenities[Math.floor(Math.random() * amenities.length)];
                    amenityChoice = randomAmenity.amenity;
                    console.log('ðŸ” EXPLORING new amenity:', amenityChoice);
                } else {
                    // Exploit: weight amenities by user preferences
                    const weightedAmenities = amenities.map(a => ({
                        ...a,
                        frequency: a.frequency + (userPreferences[a.amenity] || 0) * 2
                    }));
                    const picked = weightedPick(weightedAmenities);
                    amenityChoice = picked.amenity;
                    console.log('âœ… Using preferred amenity:', amenityChoice);
                }

                // Query POIs
                const poisRef = collection(db, 'pois');
                const poisQ = query(poisRef, where('amenity', '==', amenityChoice));
                const poisSnap = await getDocs(poisQ);

                if (poisSnap.empty) {
                    console.warn('No POIs found for', amenityChoice);
                    loadPOIMock();
                    return;
                }

                // Filter out recently shown POIs
                let availableDocs = poisSnap.docs.filter(doc => 
                    !shownPOIs.includes(doc.id)
                );

                // If all POIs have been shown, reset the list
                if (availableDocs.length === 0) {
                    console.log('All POIs shown, resetting list');
                    shownPOIs = [];
                    availableDocs = poisSnap.docs;
                }

                // Pick a random POI from available ones
                const chosenDoc = availableDocs[Math.floor(Math.random() * availableDocs.length)];
                currentPOI = {
                    ...chosenDoc.data(),
                    _id: chosenDoc.id
                };

                // Track this POI as shown
                shownPOIs.push(chosenDoc.id);

                // Keep only last 10 shown POIs to allow variety
                if (shownPOIs.length > 10) {
                    shownPOIs.shift();
                }

                updateUI();

            } catch (err) {
                console.error('Firebase error:', err);
                loadPOIMock();
            }
        }

        // Load POI with mock data
        function loadPOIMock() {
            let availablePOIs = mockPOIs.filter(poi => 
                !shownPOIs.includes(poi.name)
            );

            // If all POIs shown, reset
            if (availablePOIs.length === 0) {
                console.log('All mock POIs shown, resetting');
                shownPOIs = [];
                availablePOIs = mockPOIs;
            }
            
            // EXPLORATION: 20% chance to show random POI regardless of preferences
            const EXPLORATION_RATE = 0.20;
            
            if (Math.random() < EXPLORATION_RATE) {
                // Explore: show any random POI
                currentPOI = availablePOIs[Math.floor(Math.random() * availablePOIs.length)];
                console.log('ðŸ” EXPLORING new type:', currentPOI.type);
            } else {
                // Exploit: if user has preferences, weight by them
                let filteredPOIs = availablePOIs;
                if (Object.keys(userPreferences).length > 0) {
                    const preferredTypes = Object.keys(userPreferences)
                        .filter(k => userPreferences[k] > 0)
                        .sort((a, b) => userPreferences[b] - userPreferences[a]);
                    
                    if (preferredTypes.length > 0) {
                        const topType = preferredTypes[0];
                        const similarPOIs = availablePOIs.filter(poi => 
                            poi.type === topType || poi.amenity === topType
                        );
                        if (similarPOIs.length > 0) {
                            filteredPOIs = similarPOIs;
                        }
                    }
                }
                
                currentPOI = filteredPOIs[Math.floor(Math.random() * filteredPOIs.length)];
                console.log('âœ… Using preferred type:', currentPOI.type);
            }

            // Track shown POI
            shownPOIs.push(currentPOI.name);
            if (shownPOIs.length > 5) {
                shownPOIs.shift();
            }
            
            updateUI();
        }

        // Update UI with current POI
        function updateUI() {
            document.querySelector('.poi-name').textContent = currentPOI.name || 'Recommended Place';
            document.querySelector('.poi-distance').textContent = currentPOI.address || '';
            
            isLiked = false;
            const heartBtn = document.getElementById('heartBtn');
            heartBtn.textContent = 'â™¡';
            heartBtn.classList.remove('liked');
        }

        // Save activity log to Firebase
        async function saveActivityLog(action, amenityType, poiName) {
            if (!USE_FIREBASE || !db || !auth?.currentUser) return;
            
            try {
                const { collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                
                const logsRef = collection(db, 'activity_logs');
                await addDoc(logsRef, {
                    uid: auth.currentUser.uid,
                    email: auth.currentUser.email,
                    action: action, // 'like' or 'unlike'
                    amenityType: amenityType,
                    poiName: poiName,
                    timestamp: serverTimestamp(),
                    preferences: userPreferences
                });
                
                console.log('ðŸ“ Activity log saved:', action, amenityType);
            } catch (err) {
                console.error('âŒ Failed to save activity log:', err);
            }
        }

        // Handle like with Firebase
        async function handleLikeWithFirebase() {
            console.log('ðŸŸ¢ handleLikeWithFirebase CALLED');
            
            if (!currentPOI) {
                console.log('âŒ No current POI');
                return;
            }

            const amenityType = currentPOI.amenity || currentPOI.type;
            const poiName = currentPOI.name || 'Unknown';
            
            console.log('ðŸŸ¢ Processing like for:', poiName, 'type:', amenityType);
            
            let action;
            if (!isLiked) {
                isLiked = true;
                userPreferences[amenityType] = (userPreferences[amenityType] || 0) + 1;
                action = 'like';
                console.log('â¤ï¸ LIKED:', amenityType, '- New count:', userPreferences[amenityType]);
            } else {
                isLiked = false;
                if (userPreferences[amenityType] > 0) {
                    userPreferences[amenityType]--;
                    if (userPreferences[amenityType] === 0) {
                        delete userPreferences[amenityType];
                    }
                }
                action = 'unlike';
                console.log('ðŸ’” UNLIKED:', amenityType);
            }

            // Update UI immediately
            const heartBtn = document.getElementById('heartBtn');
            heartBtn.textContent = isLiked ? 'â™¥' : 'â™¡';
            heartBtn.classList.toggle('liked', isLiked);
            
            console.log('ðŸ“Š Current preferences:', userPreferences);

            // Save to Firebase
            try {
                if (!auth || !auth.currentUser) {
                    console.error('âŒ No authenticated user');
                    return;
                }
                
                if (!db) {
                    console.error('âŒ No Firestore database instance');
                    return;
                }

                const user = auth.currentUser;
                console.log('ðŸ” Saving for user:', user.email, 'UID:', user.uid);

                // Convert preferences to strings for Firestore
                const preferencesForFirestore = {};
                for (const key in userPreferences) {
                    preferencesForFirestore[key] = String(userPreferences[key]);
                }
                
                console.log('ðŸ“ Preferences to save:', preferencesForFirestore);

                const { collection, query, where, getDocs, doc, updateDoc, writeBatch } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                
                // Find user document by UID
                const usersRef = collection(db, 'users');
                const q = query(usersRef, where('uid', '==', user.uid));
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    console.error('âŒ No user document found for UID:', user.uid);
                    return;
                }

                console.log('ðŸ“„ Found', snapshot.size, 'user document(s)');

                // Update all matching documents (in case of duplicates)
                const batch = writeBatch(db);
                snapshot.docs.forEach(docSnapshot => {
                    console.log('ðŸ“ Updating document:', docSnapshot.id);
                    const docRef = doc(db, 'users', docSnapshot.id);
                    batch.update(docRef, { preferences: preferencesForFirestore });
                });

                await batch.commit();
                console.log('âœ…âœ…âœ… Preferences saved to Firebase!');
                console.log('   Saved data:', preferencesForFirestore);
                
                // Save activity log
                await saveActivityLog(action, amenityType, poiName);
                
            } catch (err) {
                console.error('âŒâŒâŒ Error updating preferences:', err);
                console.error('   - Error code:', err.code);
                console.error('   - Error message:', err.message);
                console.error('   - Stack:', err.stack);
            }
        }

        // Handle like (mock version)
        function handleLike() {
            console.log('ðŸ”µ handleLike called, USE_FIREBASE:', USE_FIREBASE);
            
            if (USE_FIREBASE) {
                console.log('ðŸ”µ Calling handleLikeWithFirebase...');
                handleLikeWithFirebase();
                return;
            }

            if (!currentPOI) return;
            const amenityType = currentPOI.amenity || currentPOI.type;
            
            if (!isLiked) {
                isLiked = true;
                likedPOIs.push(currentPOI);
                userPreferences[amenityType] = (userPreferences[amenityType] || 0) + 1;
            } else {
                isLiked = false;
                likedPOIs = likedPOIs.filter(poi => poi.name !== currentPOI.name);
                if (userPreferences[amenityType] > 0) {
                    userPreferences[amenityType]--;
                }
            }
            
            const heartBtn = document.getElementById('heartBtn');
            heartBtn.textContent = isLiked ? 'â™¥' : 'â™¡';
            heartBtn.classList.toggle('liked', isLiked);
            
            console.log('User preferences:', userPreferences);
        }

        // Handle refresh button
        function handleRefresh() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.add('spinning');
            
            setTimeout(() => {
                refreshBtn.classList.remove('spinning');
            }, 600);
            
            if (USE_FIREBASE) {
                loadPOIWithFirebase();
            } else {
                loadPOIMock();
            }
        }

        // Initialize Firebase if enabled
        async function initFirebase() {
            if (!USE_FIREBASE) {
                loadPOIMock();
                return;
            }

            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js');
                const { getAuth, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
                
                firebaseApp = initializeApp(firebaseConfig);
                auth = getAuth(firebaseApp);
                
                console.log('âœ… Firebase app initialized');

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log('âœ… User authenticated:', user.email);
                        loadPOIWithFirebase();
                    } else {
                        console.warn('âš ï¸ No authenticated user, using mock data');
                        loadPOIMock();
                    }
                });
            } catch (err) {
                console.error('âŒ Firebase initialization error:', err);
                loadPOIMock();
            }
        }

        // Setup event listeners
        window.addEventListener('load', () => {
            initFirebase();
            
            document.getElementById('heartBtn').addEventListener('click', handleLike);
            document.getElementById('refreshBtn').addEventListener('click', handleRefresh);
            
            document.getElementById('detailsBtn').addEventListener('click', () => {
                if (currentPOI) {
                    const address = currentPOI.address || currentPOI.name || '';
                    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`;
                    window.open(mapsUrl, '_blank');
                }
            });
        });
    </script>
</body>
</html>
